---
title: "テナントにユーザーを紐づけロールを設定する"
slug: "add-tenant-user"
excerpt: ""
hidden: false
createdAt: "Wed Nov 01 2023 22:00:34 GMT+0000 (Coordinated Universal Time)"
updatedAt: "Thu Dec 21 2023 22:59:04 GMT+0000 (Coordinated Universal Time)"
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

テナントの作成ができたら、テナントにセルフサインアップしたユーザーを紐付けます。

テナント作成のソースに下記を追記してください。

<Tabs>
<TabItem value="php" label="PHP">

```php
        // テナントにユーザ紐付け
        // 姓：画面で入力されたlastname
        // 名：画面で入力されたfirstname
        $create_tenant_user_param = new CreateTenantUserParam();
        $create_tenant_user_param->setEmail($request['userinfo']['email']);
        $create_tenant_user_param->setAttributes([
            'memo' => $validated['memo'],
        ]);
        $auth_api_client->createTenantUser($tenant->getId(), $create_tenant_user_param, $auth_api_client::FETCH_RESPONSE);
```

</TabItem>

<TabItem value="nodejs" label="Node.js">

```js
    // ユーザー属性情報の取得
    const userAttributesObj = (await client.userAttributeApi.getUserAttributes()).data
    const userAttributes = userAttributesObj.user_attributes
    let userAttributeValuesCopy = userAttributeValues || {}

    // ユーザー属性情報で number 型が定義されている場合は置換する
    userAttributes.forEach((attribute) => {
      const attributeName = attribute.attribute_name
      const attributeType = attribute.attribute_type

      if (userAttributeValuesCopy[attributeName] && attributeType === 'number') {
        userAttributeValuesCopy[attributeName] = parseInt(userAttributeValuesCopy[attributeName], 10);
      }
    });

    // テナントユーザー登録用のパラメータを作成
    const createTenantUserParam: CreateTenantUserParam = {
      email: userInfo.email,
      attributes: userAttributeValuesCopy
    }

    // SaaSユーザーをテナントユーザーに追加
    const tenantUser = (await client.tenantUserApi.createTenantUser(tenantId, createTenantUserParam)).data
```

</TabItem>

<TabItem value="go" label="Go">

```go
    // ユーザー属性情報の取得
    userAttributesResp, err := authClient.GetUserAttributesWithResponse(context.Background())
    if err != nil {
        c.Logger().Errorf("Failed to retrieve user attributes: %v", err)
        return c.JSON(http.StatusInternalServerError, echo.Map{"error": "Failed to retrieve user attributes"})
    }

    userAttributes := userAttributesResp.JSON200
    if userAttributeValues == nil {
        userAttributeValues = make(map[string]interface{})
    }

    // ユーザー属性情報で number 型が定義されている場合は置換する
    if userAttributes != nil {
        for _, attribute := range userAttributes.UserAttributes {
            attributeName := attribute.AttributeName
            attributeType := attribute.AttributeType
            if value, ok := userAttributeValues[attributeName]; ok && attributeType == "number" {
                userAttributeValues[attributeName], err = strconv.Atoi(value.(string))
                if err != nil {
                    c.Logger().Errorf("Invalid user attribute value: %v", err)
                    return c.JSON(http.StatusBadRequest, echo.Map{"error": "Invalid user attribute value"})
                }
            }
        }
    }

    // テナントユーザー登録用のパラメータを作成
    createTenantUserParam := authapi.CreateTenantUserParam{
        Email:      userInfo.Email,
        Attributes: userAttributeValues,
    }

    // SaaSユーザーをテナントユーザーに追加
    tenantUserResp, err := authClient.CreateTenantUserWithResponse(context.Background(), tenantID, createTenantUserParam)
```

</TabItem>
</Tabs>

CreateTenantUserParamオブジェクトを利用してください。

setAttributesは<a href="/docs/tutorial/prepare-saas-platform#テナントに追加属性を定義する" target="_blank">テナントに追加属性を定義する</a>で定義したテナントの属性情報をセットします。

続いて、ロールを設定します。

下記コードを追記してください。

<Tabs>
<TabItem value="php" label="PHP">

```php
        // ロール設定
        $create_tenant_user_roles_param = new CreateTenantUserRolesParam();
        $create_tenant_user_roles_param->setRoleNames(['admin']);
        $auth_api_client->createTenantUserRoles($tenant->getId(), $request['userinfo']['id'], getenv('DEFAULT_SAASUSER_ENV'), $create_tenant_user_roles_param);
```

</TabItem>

<TabItem value="nodejs" label="Node.js">

```js
    // ロール設定用のパラメータを作成
    const createTenantUserRolesParam: CreateTenantUserRolesParam = {
      role_names: ['admin']
    }

    // 作成したテナントユーザーにロールを設定
    await client.tenantUserApi.createTenantUserRoles(tenantId, tenantUser.id, 3, createTenantUserRolesParam)
```

</TabItem>

<TabItem value="go" label="Go">

```go
    // ロール設定用のパラメータを作成
    createTenantUserRolesParam := authapi.CreateTenantUserRolesParam{
        RoleNames: []string{"admin"},
    }

    // 作成したテナントユーザーにロールを設定
    _, err = authClient.CreateTenantUserRolesWithResponse(context.Background(), tenantID, tenantUserResp.JSON201.Id, 3, createTenantUserRolesParam)
```

</TabItem>
</Tabs>

CreateTenantUserRolesParamオブジェクト利用してください。

setRoleNamesは複数指定できます。

指定できる値は、<a href="/docs/tutorial/prepare-saas-platform#役割の定義" target="_blank">役割の定義</a>で作成した「役割名」が指定できます。

API経由でテナントユーザーが登録できたかどうかの確認は、「SaaSus管理コンソール＞SaaS 運用コンソール＞ユーザー管理」よりご確認頂けます。

![user](/ja/img/usecase/about-saas-user-accounts/add-tenant-user/user.png)
