---
title: "メータリングデータCSV出力手順"
slug: "export-metering-data"
excerpt: "MCPサーバーを使用して各テナントの各月のメータリング数値を出力する方法"
hidden: false
createdAt: "Wed Aug 27 2025 01:00:00 GMT+0000 (Coordinated Universal Time)"
updatedAt: "Wed Aug 27 2025 01:00:00 GMT+0000 (Coordinated Universal Time)"
---

# SaaSus Platform メータリングデータCSV出力手順

## 概要
SaaSus Platformの各テナントの各月のメータリング数値を取得し、CSV形式で出力する手順書です。

## 前提条件
- SaaSus API MCP Serverが設定済みであること

## MCP Serverへの依頼文言

### 基本的な依頼文
```
メータリングデータをCSV出力してください。

[出力設定]
出力形式 = CSV
ファイル名 = saasus_metering_data.csv
中間成果物は不要
結果のCSVファイルを直接出力
各テナントの各期間のメータリングデータを別の行として出力
期間単位 = 日 または 月 （必要に応じて変更）
キャッシュは使用せず、常に最新の情報を取得

[データ取得方法]

[必須要件]
漏れなく完全なデータ取得を実行してください。

[取得手順]
1. 全テナント取得: `gettenants` APIで全テナント一覧を取得
2. 全メータリング単位取得: `getmeteringunits` APIで全メータリング単位一覧を取得
3. 効率的なデータ取得:
   
   日単位の場合:
   - 各テナントID × 各日付の組み合わせで `getmeteringunitdatecountsbytenantidanddate` APIを実行
   
   月単位の場合:
   - 各テナントID × 各月の組み合わせで `getmeteringunitmonthcountsbytenantidandmonth` APIを実行
   
   - 実際にデータが存在する場合のみCSVに含める
   - データが存在しない場合（counts配列が空）は、そのテナント×期間の組み合わせをスキップ
4. データ確認: 各APIレスポンスでcounts配列の内容を確認し、空配列でない場合のみデータを採用

[フィールド設定]
テナントID = true
テナント名 = true
メーター名 = true
使用量 = true
期間 = true
; その他カスタム属性がある場合は、以下に追加してください
; カスタム属性1 = true
; カスタム属性2 = true

[フィールド説明]
テナントID: テナントの一意識別子
テナント名: テナントの表示名
メーター名: メータリング単位の表示名（display_name）
使用量: 該当期間の使用量
期間: メータリング対象期間（月単位: 2025-8、日単位: 2025-08-15）

[出力条件]
; メータリングデータを出力する際のフィルタ条件を設定します
; 例: 特定のテナントのメータリングデータのみを出力する場合は、以下のように設定します
; テナント名 = 特定のテナント名
; 例: 特定の期間のメータリングデータのみを出力する場合は、以下のように設定します
; 期間 = 2025-8
;
; 月単位の例:
; 期間単位 = 月
; 期間開始 = 2025-6
; 期間終了 = 2025-8
; 日単位の例:
; 期間単位 = 日
; 期間開始 = 2025-08-01
; 期間終了 = 2025-08-31
; 例: 特定のメーターのメータリングデータのみを出力する場合は、以下のように設定します
; メーター名 = API呼び出し
期間単位 = 月
期間開始 = 2025-6
期間終了 = 2025-8

[出力例]
; 以下は出力されるCSVの例です（月単位の場合）
; テナントID,テナント名,メーター名,使用量,期間
; tenant-001,サンプルテナント1,アクティブユーザー数,13,2025-08-27
; tenant-001,サンプルテナント1,コメント数,3,2025-08-27
; tenant-002,サンプルテナント2,テスト使用量,5,2025-08-27

; 以下は日単位での出力例です（日単位の場合）
; テナントID,テナント名,メーター名,使用量,期間
; tenant-001,サンプルテナント1,API呼び出し,1200,2025-7
; tenant-001,サンプルテナント1,ストレージ,550,2025-7
; tenant-002,サンプルテナント2,API呼び出し,850,2025-7
; tenant-002,サンプルテナント2,ストレージ,320,2025-7

[重要な注意事項]
1. 全組み合わせチェック: 全テナント × 全期間の組み合わせで必ずデータ存在確認を実行
2. API使用優先順位: 
   - 日単位: `getmeteringunitdatecountsbytenantidanddate`（一回で該当日の全メーター取得）
   - 月単位: `getmeteringunitmonthcountsbytenantidandmonth`（一回で該当月の全メーター取得）
   - 個別メーター単位での取得は効率性のため避ける
3. データ品質確保: 使用量が0の場合とデータが存在しない場合を区別する
4. 進捗報告: データ取得中は「○件目/全○件のテナント×期間を処理中」のような進捗を示す
```

## 出力ファイル形式

### CSVヘッダー
```csv
テナントID,テナント名,メーター名,使用量,期間
```

### データ行の例（月単位）
```csv
tenant-001,サンプルテナント1,アクティブユーザー数,13,2025-08-27
tenant-001,サンプルテナント1,コメント数,3,2025-08-27
tenant-002,サンプルテナント2,テスト使用量,5,2025-08-27
```

### データ行の例（日単位）
```csv
tenant-001,サンプルテナント1,API呼び出し,1200,2025-7
tenant-001,サンプルテナント1,ストレージ,550,2025-7
tenant-002,サンプルテナント2,API呼び出し,850,2025-7
tenant-002,サンプルテナント2,ストレージ,320,2025-7
```



## 注意事項

- 同一テナントが複数のメーターを使用している場合、メーターごとに別の行として出力されます
- 同一テナントが複数の期間のデータを持つ場合、期間ごとに別の行として出力されます
- 期間範囲を指定した場合、指定した範囲内のすべての期間のデータが出力されます
- 日単位で出力する場合、行数が多くなる可能性があります（例：1ヶ月分で約30行×テナント数×メーター数）
- フィルタ条件を指定した場合、条件に合致するメータリングデータのみが出力されます
- 出力されるデータは実行時点での最新情報です（キャッシュは使用されません）

## カスタマイズ

### フィールドの追加
カスタム属性を出力に含めたい場合は、[フィールド設定]セクションで該当項目を`true`に設定してください。

### フィルタ条件の変更
特定の条件でメータリングデータを絞り込みたい場合は、[出力条件]セクションで条件を指定してください。複数の条件を組み合わせることも可能です。