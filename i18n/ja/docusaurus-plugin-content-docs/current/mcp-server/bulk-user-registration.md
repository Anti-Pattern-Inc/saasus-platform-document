---
title: "ユーザー一括登録手順"
slug: "bulk-user-registration"
excerpt: ""
hidden: false
createdAt: "Fri Jan 20 2023 01:47:47 GMT+0000 (Coordinated Universal Time)"
updatedAt: "Wed May 22 2024 15:16:11 GMT+0000 (Coordinated Universal Time)"
---

# SaaSus Platform ユーザー一括登録手順

## 概要
CSVファイルから複数のユーザーを効率的に一括登録する手順書です。複数テナント・複数ロールの組み合わせに対応し、必要なリソースの自動作成も含めて完全自動化されています。

## 前提条件
- SaaSus API MCP Serverが設定済みであること

## MCP Serverへの依頼文言

### 基本的な依頼文
```
users.csvファイルを読み込んで、SaaSus API MCP Serverを使用してユーザーの一括登録を実行してください。

【重要】以下の処理をすべて自動で実行してください：

1. CSVファイルの読み込み
   - email: メールアドレス（必須）
   - tenant_name: テナント名（必須、複数テナントの場合は行を分ける）
   - role: ロール（必須、単一ロール、複数ロールの場合は行を分ける）
   - env: 環境ID（必須）
   - name: 名前（属性として設定、オプション）
   - カスタム属性: envより右の列はすべてカスタム属性として扱う（オプション）

2. 必要なリソースの確認とバリデーション（効率化処理）
   - CSVヘッダーのカスタム属性（name含む）が定義されているか確認し、存在しない場合はCSV読み込み時点でエラー
   - 各行について以下の順序でチェックし、スキップが確定した時点で他の項目はチェックしない：
     1. テナント名が存在するか確認し、存在しない場合はその行をスキップ
     2. ロールが存在するか確認し、存在しない場合はその行をスキップ
     3. 環境IDが存在するか確認し、存在しない場合はその行をスキップ

3. ユーザーの一括登録
   - 事前処理: CSVファイル全体を読み込み、バリデーションを実行してからemailごとにデータをグループ化
   - ユーザー作成: 各emailについて初回出現時にSaaSユーザーを作成（パスワードなし、メール通知）
   - テナント処理: 各emailの各テナントについて初回出現時にテナントユーザーを作成し、name属性を設定
   - ロール処理: 各行ごとに指定されたロールを割り当て
   - 環境設定: CSVのenv列で指定された環境でロール割り当てを実行
   - 重複回避: 既存のSaaSユーザー・テナントユーザーは作成をスキップし、ロール追加のみ実行

4. 結果の報告
   - 処理されたCSV行数と成功/スキップ/失敗の詳細
   - スキップされた行の理由（存在しないテナント、ロール、環境ID）
   - 登録成功したユーザーの詳細
   - エラーがあった場合の詳細情報

すべての処理を自動で実行し、最後に詳細なレポートを提供してください。
```

## CSVファイル形式

### ファイル構造
```csv
email,tenant_name,role,env,name
user1@example.com,company_a,admin,3,田中太郎
user1@example.com,company_a,user,3,田中太郎
user2@example.com,company_a,user,3,佐藤花子
user3@example.com,company_b,user,3,鈴木次郎
user4@example.com,company_a,user,3,山田三郎
user4@example.com,company_a,viewer,3,山田三郎
user5@example.com,company_b,admin,3,高橋美咲
user5@example.com,company_a,user,3,高橋美咲
user5@example.com,company_b,user,3,高橋美咲
```

### 列の説明
- **email**: ユーザーのメールアドレス（必須）
- **tenant_name**: 所属するテナント名（必須、複数テナントの場合は行を分ける、存在しない場合はスキップ）
- **role**: 割り当てるロール（必須、単一ロール、複数ロールの場合は行を分ける、存在しない場合はスキップ）
- **env**: 環境ID（必須、存在しない場合はスキップ）
- **name**: ユーザーの名前（属性として設定、オプション）
- **カスタム属性**: envより右の列はすべてカスタム属性として扱う（オプション、存在しない属性の場合はCSV読み込み時点でエラー）

### 複数テナント・複数ロールの扱い
- **複数ロール**: 同一ユーザーが複数のロールを持つ場合は、行を分けて記載
- **複数テナント**: 同一ユーザーが複数のテナントに所属する場合は、行を分けて記載
- **組み合わせ**: 複数テナント×複数ロールの場合は、すべての組み合わせを行で記載