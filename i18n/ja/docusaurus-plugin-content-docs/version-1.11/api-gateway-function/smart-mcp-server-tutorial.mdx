---
title: "Smart MCP Server チュートリアル"
slug: "smart-mcp-server-tutorial"
excerpt: ""
hidden: false
createdAt: "Sun May 26 2025 07:00:00 GMT+0000 (Coordinated Universal Time)"
updatedAt: "Sun May 26 2025 07:00:00 GMT+0000 (Coordinated Universal Time)"
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";


このチュートリアルでは、Smart API Gateway機能で公開したAPIを、AIエージェントが利用できるMCPサーバーとして公開する手順を説明します。

### 前提条件

このチュートリアルを開始する前に、以下が完了していることを確認してください：

- [Smart API Gateway機能](./manual.mdx)でAPIが公開済みであること
- SaaSus Platform開発コンソールへのアクセス権限があること
- API Keyが発行されていること

:::info
Smart MCP Server機能は、Smart API Gateway機能で公開されたAPIを自動的にMCPサーバーとして提供します。<br/>
まだSmart API Gateway機能を設定していない場合は、先に[設定手順](./manual.mdx)を完了してください。
:::

---

## Step 1: SaaSus Platform開発コンソールにアクセス

1. [SaaSus Platform開発コンソール](https://settings.console.saasus.io/dashboard)にログインします。
2. 左側のメニューから **Smart API Gateway** を選択します。
3. APIが公開されている状態であることを確認します。

![smart-mcp-server-tutorial-1](/ja/img/api-gateway-function/smart-mcp-server-tutorial-1.png)

---

## Step 2: MCPサーバーエンドポイントの確認

Smart API Gateway機能でAPIが正常に公開されると、以下の情報が表示されますので控えてください。

- **MCPサーバーエンドポイント**: AIエージェントが接続するためのエンドポイント

![smart-mcp-server-tutorial-2](/ja/img/api-gateway-function/smart-mcp-server-tutorial-2.png)

---

## Step 3: APIキーの確認

SaaS運用コンソール→ユーザー管理の画面から、特定のユーザーのAction列のAPIキー管理ボタンを押下後
ダイアログでAPIキーが表示されますので控えてください。（もし未発行の場合は、新しく発行してください）

![smart-mcp-server-tutorial-3](/ja/img/api-gateway-function/smart-mcp-server-tutorial-3.png)

## Step 4: AIエージェントでの接続テスト

:::info
現時点では、OpenAI Playgroundでの接続テストのみサポートしております。
:::

<Tabs>
<TabItem value="openai-playground" label="OpenAI Playground" default>

1. [OpenAI Playground](https://platform.openai.com/playground) にアクセスします
2. **Tools** セクションで **Create...** をクリックします
3. **MCP Server** を選択します
  ![smart-mcp-server-tutorial-4](/ja/img/api-gateway-function/smart-mcp-server-tutorial-4.png)
4. **Add New** を選択します
  ![smart-mcp-server-tutorial-5](/ja/img/api-gateway-function/smart-mcp-server-tutorial-5.png)
5. 表示されたフォームにそれぞれ値を入力します
  - **URL** : 控えておいた**MCPサーバーエンドポイント**
  - **Label** : 任意のラベル
  - **Authentication** : 控えておいた**APIキー**
  ![smart-mcp-server-tutorial-6](/ja/img/api-gateway-function/smart-mcp-server-tutorial-6.png)
7. **Connect**を押下します
8. 少し待つと、公開したAPI

```json
{
  "name": "saasus_api_call",
  "description": "SaaS運用コンソールのAPIを呼び出す",
  "parameters": {
    "type": "object",
    "properties": {
      "endpoint": {
        "type": "string", 
        "description": "呼び出すAPIエンドポイント（例: /tenants, /users）"
      },
      "method": {
        "type": "string",
        "enum": ["GET", "POST", "PUT", "DELETE"],
        "description": "HTTPメソッド"
      },
      "payload": {
        "type": "object",
        "description": "リクエストボディ（POST/PUTの場合）"
      },
      "query_params": {
        "type": "object", 
        "description": "クエリパラメータ"
      }
    },
    "required": ["endpoint", "method"]
  }
}
```

5. **Code** セクションで以下の関数実装を追加します：

```javascript
async function saasus_api_call({ endpoint, method, payload, query_params }) {
  const baseUrl = "https://mcp.saasus.io/your-saas-id";
  const url = new URL(endpoint, baseUrl);
  
  if (query_params) {
    Object.entries(query_params).forEach(([key, value]) => {
      url.searchParams.append(key, value);
    });
  }
  
  const options = {
    method: method,
    headers: {
      'Authorization': 'Bearer your-api-key-here',
      'Content-Type': 'application/json'
    }
  };
  
  if (payload && (method === 'POST' || method === 'PUT')) {
    options.body = JSON.stringify(payload);
  }
  
  try {
    const response = await fetch(url.toString(), options);
    const data = await response.json();
    return data;
  } catch (error) {
    return { error: error.message };
  }
}
```

6. **Save** をクリックして設定を保存します

</TabItem>
</Tabs>

---

## Step 5: AIエージェントからのAPI呼び出しテスト

### OpenAI Playground でのテスト例

OpenAI Playground で以下のようにプロンプトを入力してテストしてください：

```
在庫情報を取得してください。テナントIDは "tenant-123" です。
```

AIが自動的に `saasus_api_call` 関数を使用して API を呼び出し、結果を返します。

### 期待される応答例

```
在庫情報を取得しました：

製品名: サンプル商品A
在庫数: 150個
最終更新: 2025-05-26 10:30:00

製品名: サンプル商品B  
在庫数: 75個
最終更新: 2025-05-26 09:45:00
```

---

## Step 6: エラーのトラブルシューティング

### よくある問題と解決方法

#### 1. MCPサーバーに接続できない

**症状**: AIエージェントがMCPサーバーに接続できない

**解決方法**:
- API Keyが正しく設定されているか確認
- MCPサーバーのステータスがアクティブか確認
- ネットワーク接続を確認

#### 2. API呼び出しが失敗する

**症状**: MCPサーバー経由でのAPI呼び出しがエラーになる

**解決方法**:
- Smart API Gateway で直接APIが正常に動作するか確認
- API Keyの権限設定を確認
- スロットリング制限に達していないか確認

#### 3. ツールが表示されない

**症状**: AIエージェントでツールの一覧が表示されない

**解決方法**:
- Smart API Gateway でAPIが正常に公開されているか確認
- MCPサーバーを一度無効化・再有効化してみる
- ブラウザのキャッシュをクリアしてから再試行

---

## まとめ

このチュートリアルでは、Smart MCP Server機能を使用してAPIをAIエージェント向けに公開する方法を学習しました。

### 完了した内容

- Smart MCP Server機能の有効化
- MCPサーバーエンドポイントの確認
- AIエージェント（Claude Desktop）での接続設定
- API呼び出しのテスト
- トラブルシューティング
- 高度な設定とセキュリティ対策

### 次のステップ

- より複雑なAPIワークフローの自動化
- 複数のAIエージェントでの利用
- カスタムMCPクライアントの開発
- ビジネスプロセスへの統合

:::info
Smart MCP Server機能に関するご質問やサポートが必要な場合は、[サポート申請フォーム](https://forms.gle/XhFD9fCQv1zVGyRT9)からお問い合わせください。
:::