"use strict";(self.webpackChunksaasus_platform_document=self.webpackChunksaasus_platform_document||[]).push([[9817],{5455:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-15-4f4d82d96cf4760470c5037e236f9934.png"},9584:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-12-78845443352407f1aa192200d8514c80.png"},11330:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-10-e9c6ab68bcf17262b3a80ac25d1d3171.png"},12009:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-04-f51f4d78ee33e0323193334985843c3c.png"},15839:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-02-8d2b64f4f02bfdce0e4fccdb9667e65e.png"},20358:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-14-98e8a77dd2c20795a3eaa64cf52a9536.png"},25337:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-13-20a01174936edab7169e50ac04dc28ee.png"},28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>l});var s=a(96540);const t={},r=s.createContext(t);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},30564:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-01-9aebd2fbbc2d769d853c6e606df30fe9.png"},51578:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"tutorial/authentication-preference","title":"Authentication Preference","description":"Creating a SaaS consumer tenant","source":"@site/versioned_docs/version-1.12/tutorial/authentication-preference.mdx","sourceDirName":"tutorial","slug":"/tutorial/authentication-preference","permalink":"/docs/tutorial/authentication-preference","draft":false,"unlisted":false,"tags":[],"version":"1.12","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Authentication Preference","slug":"authentication-preference","excerpt":"","hidden":false,"createdAt":"Fri Jan 20 2023 01:46:49 GMT+0000 (Coordinated Universal Time)","updatedAt":"Thu Dec 07 2023 01:25:35 GMT+0000 (Coordinated Universal Time)"},"sidebar":"tutorialSidebar","previous":{"title":"Configuring SDK For SaaSus Platform","permalink":"/docs/tutorial/configuring-sdk-for-saasus-platform"},"next":{"title":"Manage Rate Plans","permalink":"/docs/tutorial/manage-rate-plans/manage-rate-plans"}}');var t=a(74848),r=a(28453),i=a(65537),l=a(79329);const o={sidebar_position:3,title:"Authentication Preference",slug:"authentication-preference",excerpt:"",hidden:!1,createdAt:"Fri Jan 20 2023 01:46:49 GMT+0000 (Coordinated Universal Time)",updatedAt:"Thu Dec 07 2023 01:25:35 GMT+0000 (Coordinated Universal Time)"},c=void 0,d={},h=[{value:"Creating a SaaS consumer tenant",id:"creating-a-saas-consumer-tenant",level:3},{value:"Creating a SaaS user",id:"creating-a-saas-user",level:3},{value:"Incorporating an Authentication Module",id:"incorporating-an-authentication-module",level:3},{value:"Removing Individual Authentication Logic (Express)",id:"removing-individual-authentication-logic-express",level:3},{value:"Implementing the Callback URL Handler",id:"implementing-the-callback-url-handler",level:3},{value:"Verify SaaSus SDK integration",id:"verify-saasus-sdk-integration",level:3},{value:"Multi-tenancy of sample application",id:"multi-tenancy-of-sample-application",level:3}];function u(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h3,{id:"creating-a-saas-consumer-tenant",children:"Creating a SaaS consumer tenant"}),"\n",(0,t.jsx)(n.p,{children:"First, let's create two tenants for the sample application."}),"\n",(0,t.jsx)(n.p,{children:"Click \u201cTenant management\u201d on the side menu."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"01",src:a(30564).A+"",width:"2880",height:"751"})}),"\n",(0,t.jsx)(n.p,{children:"Click the \u201cCreating a tenant\u201d button to display a pop-up."}),"\n",(0,t.jsxs)(n.p,{children:["The tenant name, addition of representative user, representative email address, representative temporary password, and other tenant attributes added in ",(0,t.jsx)(n.a,{href:"/docs/part-4/application-settings/declare-additional-attribute-to-tenant",children:"Tenant Attributes"}),", introduced in Docs are displayed."]}),"\n",(0,t.jsx)(n.p,{children:"First one"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"tenant name\uff1aTenant sample 1"}),"\n",(0,t.jsx)(n.li,{children:"memo\uff1aThis is the attribute information defined in tenant attributes and can be set freely."}),"\n",(0,t.jsx)(n.li,{children:"Add representative user\uff1aCreate a new user"}),"\n",(0,t.jsxs)(n.li,{children:["Representative email address\uff1a ",(0,t.jsx)(n.a,{href:"mailto:saasus-sample-tenant1@example.com",children:"saasus-sample-tenant1@example.com"})]}),"\n",(0,t.jsx)(n.li,{children:"Representative's temporary password\uff1a Password requirements such as G@2qYPQq"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"02",src:a(15839).A+"",width:"1440",height:"769"})}),"\n",(0,t.jsx)(n.p,{children:"The second one"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"tenant name\uff1aSample app tenant 2"}),"\n",(0,t.jsx)(n.li,{children:"memo\uff1aThis is the attribute information defined in tenant attributes and can be set freely."}),"\n",(0,t.jsx)(n.li,{children:"Add representative user\uff1aCreate a new user"}),"\n",(0,t.jsxs)(n.li,{children:["Representative email address\uff1a ",(0,t.jsx)(n.a,{href:"mailto:saasus-sample-tenant2@example.com",children:"saasus-sample-tenant2@example.com"})]}),"\n",(0,t.jsx)(n.li,{children:"Representative's temporary password\uff1a Password requirements such as irG_l88r"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"(There is no set rule, so you can enter other values as well.)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"03",src:a(62038).A+"",width:"2880",height:"724"})}),"\n",(0,t.jsx)(n.p,{children:"You have now created a tenant and one user belonging to that tenant."}),"\n",(0,t.jsx)(n.h3,{id:"creating-a-saas-user",children:"Creating a SaaS user"}),"\n",(0,t.jsx)(n.p,{children:'Now, let\'s take a look at the user list. Click "User management" from the side menu.'}),"\n",(0,t.jsx)(n.p,{children:"The user you created earlier is registered as the admin (SaaS administrator) role for each tenant and each environment."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"04",src:a(12009).A+"",width:"2880",height:"1014"})}),"\n",(0,t.jsx)(n.p,{children:'The SaaSus Platform allows the concept of an "environment" to be used as a tenant for SaaS users.'}),"\n",(0,t.jsxs)(n.p,{children:["For example, in a SaaS like Stripe that primarily uses APIs, SaaS users will need an environment for testing and developing integrations. ",(0,t.jsx)("br",{}),"\nSaaS administrators can now define multiple environments, such as using an environment called a development environment to perform these tasks and an environment called a production environment for actual operations."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"05",src:a(87808).A+"",width:"1440",height:"163"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Depending on SaaS, multiple environments may not be necessary, so if you use a single environment, you only need to be aware of the production environment."})}),"\n",(0,t.jsx)(n.p,{children:"Now, let's register one user for each tenant."}),"\n",(0,t.jsx)(n.p,{children:'Click the "Create a new user" button in the upper right corner to display a popup.'}),"\n",(0,t.jsxs)(n.p,{children:["The email address, password, tenant, and other user attributes added in ",(0,t.jsx)(n.a,{href:"/docs/part-4/user-authz-settings/declare-additional-attribute-to-user",children:"User Attributes"}),", introduced in Docs, are displayed."]}),"\n",(0,t.jsx)(n.p,{children:"For now, let's register 4 people."}),"\n",(0,t.jsxs)(n.p,{children:["email address: ",(0,t.jsx)(n.a,{href:"mailto:user1-1@example.com",children:"user1-1@example.com"}),(0,t.jsx)(n.br,{}),"\n","password\uff1a Meets password requirements",(0,t.jsx)(n.br,{}),"\n","tenant\uff1a Tenant sample 1",(0,t.jsx)(n.br,{}),"\n","username\uff1a User1-1"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"06",src:a(85371).A+"",width:"1440",height:"706"})}),"\n",(0,t.jsxs)(n.p,{children:["email address: ",(0,t.jsx)(n.a,{href:"mailto:user1-2@example.com",children:"user1-2@example.com"}),(0,t.jsx)(n.br,{}),"\n","password\uff1a Meets password requirements",(0,t.jsx)(n.br,{}),"\n","tenant\uff1a Tenant sample 1",(0,t.jsx)(n.br,{}),"\n","username\uff1a User1-2"]}),"\n",(0,t.jsxs)(n.p,{children:["email address: ",(0,t.jsx)(n.a,{href:"mailto:user2-1@example.com",children:"user2-1@example.com"}),(0,t.jsx)(n.br,{}),"\n","password\uff1a Meets password requirements",(0,t.jsx)(n.br,{}),"\n","tenant\uff1a Sample app tenant 2",(0,t.jsx)(n.br,{}),"\n","username\uff1a User2-1"]}),"\n",(0,t.jsxs)(n.p,{children:["email address: ",(0,t.jsx)(n.a,{href:"mailto:user2-2@example.com",children:"user2-2@example.com"}),(0,t.jsx)(n.br,{}),"\n","password\uff1a Meets password requirements",(0,t.jsx)(n.br,{}),"\n","tenant\uff1a Sample app tenant 2",(0,t.jsx)(n.br,{}),"\n","username\uff1a User2-2"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"07",src:a(63826).A+"",width:"1440",height:"910"})}),"\n",(0,t.jsx)(n.p,{children:"I was able to register 4 additional users."}),"\n",(0,t.jsx)(n.p,{children:"Please assign appropriate roles to these users using the steps below."}),"\n",(0,t.jsxs)(n.admonition,{title:"Required setup before continuing the tutorial",type:"caution",children:[(0,t.jsx)(n.p,{children:"To proceed smoothly with the following tutorial steps, it is essential to assign appropriate roles to users in advance."}),(0,t.jsx)(n.p,{children:"Refer to the following page to complete this setup:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/part-4/user-authz-settings/role-definition",children:"Roles"})}),"\n"]})]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"The following steps require programming knowledge."})}),"\n",(0,t.jsx)(n.h3,{id:"incorporating-an-authentication-module",children:"Incorporating an Authentication Module"}),"\n",(0,t.jsx)(n.p,{children:"Integrate the authentication module provided by the SaaSus Platform."}),"\n",(0,t.jsx)(n.p,{children:"In this application, all URI routes will require authentication. If a user is not authenticated, they will not be able to access the application."}),"\n",(0,t.jsx)(n.p,{children:"Currently, authentication is handled in the following files:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For Laravel: ",(0,t.jsx)(n.code,{children:"api/routes/web.php"})]}),"\n",(0,t.jsxs)(n.li,{children:["For Express: ",(0,t.jsx)(n.code,{children:"api/app.ts"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You will replace the existing authentication logic with the one provided by SaaSus."}),"\n",(0,t.jsxs)(i.A,{children:[(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"Route::middleware('auth')->group(function () {\n   Route::get('/', function () {\n       return view('welcome');\n   });\n   Route::get('/dispatch', 'App\\Http\\Controllers\\DispatchController@index')->name('dispatch');\n   Route::get('/board', 'App\\Http\\Controllers\\MessageController@index')->name('board');\n   Route::post('/post', 'App\\Http\\Controllers\\MessageController@post')->name('post');\n});\n\nrequire __DIR__ . '/auth.php';\n"})})}),(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'app.use(\n  session({\n    secret: "secret",\n    resave: false,\n    saveUninitialized: false,\n  })\n);\napp.use(passport.initialize());\napp.use(passport.session());\n'})})})]}),"\n",(0,t.jsx)(n.p,{children:"change"}),"\n",(0,t.jsxs)(i.A,{children:[(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Route::middleware('auth')->group(function () {\n//     Route::get('/', function () {\n//         return view('welcome');\n//     });\n// Use SaaSus SDK standard Auth Middleware\nRoute::middleware(\\AntiPatternInc\\Saasus\\Laravel\\Middleware\\Auth::class)->group(function () {\n   Route::get('/dispatch', 'App\\Http\\Controllers\\DispatchController@index')->name('dispatch');\n   Route::get('/board', 'App\\Http\\Controllers\\MessageController@index')->name('board');\n   Route::post('/post', 'App\\Http\\Controllers\\MessageController@post')->name('post');\n\n   Route::redirect('/', '/board');\n});\n\n// require __DIR__ . '/auth.php';\n"})})}),(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import { AuthMiddleware } from "saasus-sdk";\n...\n// app.use(\n//   session({\n//     secret: "secret",\n//     resave: false,\n//     saveUninitialized: false,\n//   })\n// );\napp.use(\n  ["/chat", "/api/board", "/api/post", "/api/plan", "/api/tenant"],\n  AuthMiddleware\n);\n// app.use(passport.initialize());\n// app.use(passport.session());\n'})})})]}),"\n",(0,t.jsx)(n.h3,{id:"removing-individual-authentication-logic-express",children:"Removing Individual Authentication Logic (Express)"}),"\n",(0,t.jsx)(n.p,{children:"In Express, individual authentication logic was implemented for each route. These need to be removed."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"For Laravel: No changes are required"}),"\n",(0,t.jsxs)(n.li,{children:["For Express: Modify ",(0,t.jsx)(n.code,{children:"api/routes/chat.ts"})]}),"\n"]}),"\n",(0,t.jsx)(i.A,{children:(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'router.get(\n  "/",\n  (req: Request, res: Response, next: NextFunction) => {\n    if (req.isAuthenticated()) {\n      next();\n    } else {\n      res.redirect(302, "/login");\n    }\n  },\n  getChats\n);\n'})})})}),"\n",(0,t.jsx)(n.p,{children:"\u3092"}),"\n",(0,t.jsx)(i.A,{children:(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'router.get("/", getChats);\n'})})})}),"\n",(0,t.jsx)(n.h3,{id:"implementing-the-callback-url-handler",children:"Implementing the Callback URL Handler"}),"\n",(0,t.jsx)(n.p,{children:"Earlier, you defined the callback URL in the SaaS Development Console as:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For Laravel: ",(0,t.jsx)(n.a,{href:"http://localhost/callback",children:"http://localhost/callback"})]}),"\n",(0,t.jsxs)(n.li,{children:["For Express: ",(0,t.jsx)(n.a,{href:"http://localhost:3000/callback",children:"http://localhost:3000/callback"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Now you need to configure the application to handle requests at ",(0,t.jsx)(n.code,{children:"/callback"}),"."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For Laravel:",(0,t.jsx)(n.br,{}),"\n","Add the following line to the end of ",(0,t.jsx)(n.code,{children:"api/routes/web.php"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.A,{children:(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Use the SaaSus SDK standard Callback Controller to put the JWT into Cookies or Local Storage\nRoute::get('/callback', 'AntiPatternInc\\Saasus\\Laravel\\Controllers\\CallbackController@index');\n"})})})}),"\n",(0,t.jsx)(n.p,{children:"Furthermore, to be able to use the View provided by the SaaSus SDK,"}),"\n",(0,t.jsxs)(n.p,{children:["Add the path to ",(0,t.jsx)(n.code,{children:"api/config/view.php"}),"."]}),"\n",(0,t.jsx)(i.A,{children:(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"   'paths' => [\n       resource_path('views'),\n       # \u2193Add this line: Directory of views provided by SaaSus SDK\n       resource_path('../vendor/saasus-platform/saasus-sdk-php/src/Laravel/Views'),\n   ],\n"})})})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For Express:",(0,t.jsx)(n.br,{}),"\n","Add an ",(0,t.jsx)(n.code,{children:"import"})," statement and ",(0,t.jsx)(n.code,{children:"app.use"})," to ",(0,t.jsx)(n.code,{children:"api/app.ts"})," to include the router that handles requests to the ",(0,t.jsx)(n.code,{children:"/callback"})," path."]}),"\n"]}),"\n",(0,t.jsx)(i.A,{children:(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import { router as callbackRouter } from "./routes/callback";\n\n// Other code omitted\n\napp.use("/callback", callbackRouter);\n'})})})}),"\n",(0,t.jsxs)(n.p,{children:["To handle GET requests to ",(0,t.jsx)(n.code,{children:"/callback"}),", create ",(0,t.jsx)(n.code,{children:"api/routes/callback.ts"})," and use the ",(0,t.jsx)(n.code,{children:"CallbackRouteFunction"})," provided by the SaaSus SDK."]}),"\n",(0,t.jsx)(i.A,{children:(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'import express from "express";\nconst router = express.Router();\nimport { CallbackRouteFunction } from "saasus-sdk";\n\nrouter.get("/", CallbackRouteFunction);\n\nexport { router };\n'})})})}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"views/callback.ejs"})," as the screen to display after login (in this case, it will redirect to ",(0,t.jsx)(n.code,{children:"/chat"}),")."]}),"\n",(0,t.jsx)(i.A,{children:(0,t.jsx)(l.A,{value:"ejs",label:"Express (EJS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset="utf-8" />\n    <meta name="viewport" content="width=device-width, initial-scale=1" />\n\n    <title>Auth Callback</title>\n  </head>\n\n  <body>\n    <script>\n      location.href = "/chat";\n    <\/script>\n  </body>\n</html>\n'})})})}),"\n",(0,t.jsx)(n.p,{children:"Once everything is set up, the authentication information configured in the SaaSus Platform will be passed as part of the request when it reaches your application\u2019s controller."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For Laravel: Add ",(0,t.jsx)(n.code,{children:"Request"})," as a parameter to the ",(0,t.jsx)(n.code,{children:"index"})," method in ",(0,t.jsx)(n.code,{children:"api/app/Http/Controllers/MessageController.php"}),", and use ",(0,t.jsx)(n.code,{children:"dd"})," to check if ",(0,t.jsx)(n.code,{children:"userinfo"})," is included in ",(0,t.jsx)(n.code,{children:"$request"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["For Express: Inside the ",(0,t.jsx)(n.code,{children:"getChats"})," method in ",(0,t.jsx)(n.code,{children:"api/controllers/chat.ts"}),", use ",(0,t.jsx)(n.code,{children:"console.log"})," to check if ",(0,t.jsx)(n.code,{children:"userinfo"})," is present in ",(0,t.jsx)(n.code,{children:"req"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.A,{children:[(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"   public function index(Request $request)\n   {\n       // Check whether user information is being passed from SaaSus Platform\n       dd($request->userinfo);\n"})})}),(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const getChats = async (req: Request, res: Response) => {\n  // Check whether user information is being passed from SaaSus Platform\n  console.dir(req.userInfo,{depth:null});\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"Up to this point, we have established the basics of collaboration."}),"\n",(0,t.jsx)(n.p,{children:"Log in from SaaSus Platform and check the operation."}),"\n",(0,t.jsx)(n.h3,{id:"verify-saasus-sdk-integration",children:"Verify SaaSus SDK integration"}),"\n",(0,t.jsx)(n.p,{children:"Display the login screen created with SaaSus Platform."}),"\n",(0,t.jsxs)(n.p,{children:['You can find the login screen URL in the "Authentication Details" section of the side menu.\n',(0,t.jsx)(n.img,{alt:"15",src:a(5455).A+"",width:"2910",height:"1054"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"09",src:a(81356).A+"",width:"1440",height:"525"})}),"\n",(0,t.jsx)(n.p,{children:"When you log in with the user email address and password you created earlier, you will be redirected to the URL you set in Callback URL along with your credentials."}),"\n",(0,t.jsxs)(n.p,{children:["For example, let's log in as ",(0,t.jsx)(n.a,{href:"mailto:user1-1@example.com",children:"user1-1@example.com"}),"."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"For Laravel, if the previous code is working correctly, the user information should be displayed on the screen after login."}),"\n",(0,t.jsx)(n.li,{children:"For Express, first run the following command in the terminal to enable log output, then proceed to log in."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"repo$ docker compose logs -f\n"})}),"\n",(0,t.jsxs)(i.A,{children:[(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'array:3 [\u25bc\n  "email" => "user1-1@example.com"\n  "id" => "f6a02019-1306-431f-b93d-3a756b312481"\n  "tenants" => array:1 [\u25bc\n    0 => array:7 [\u25bc\n      "back_office_staff_email" => "saasus-sample-tenant1@example.com"\n      "completed_sign_up" => true\n      "envs" => array:1 [\u25bc\n        0 => array:3 [\u25bc\n          "id" => 1\n          "name" => "dev"\n          "roles" => array:1 [\u25bc\n            0 => array:2 [\u25bc\n              "display_name" => "General users"\n              "role_name" => "user"\n            ]\n          ]\n        ]\n      ]\n      "id" => "7b639774-6fba-4b26-b580-f3d755876a4b"\n      "name" => "Tenant sample 1"\n      "plan_id" => "bc011444-a9f1-41c0-8251-bc8928b09ee7"\n      "user_attribute" => array:1 [\u25bc\n        "username" => "user1-1"\n      ]\n    ]\n  ]\n]\n'})})}),(0,t.jsx)(l.A,{value:"express-logs",label:"Express (Docker Logs)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"{\n  email: 'user1-1@example.com',\n  id: '951fe2e3-b89b-40cf-95db-2fc11f09cbdf',\n  tenants: [\n    {\n      back_office_staff_email: 'saasus-sample-tenant1@example.com',\n      completed_sign_up: true,\n      envs: [\n        {\n          id: 3,\n          name: 'prod',\n          roles: [ { display_name: 'General User', role_name: 'user' } ]\n        }\n      ],\n      id: '2d76c5ed-8462-4de0-b107-97bb97b7e9e2',\n      is_paid: true,\n      name: 'Tenant Sample 1',\n      plan_id: 'ddb8b9e9-5fe4-48cc-846e-b9031552877a',\n      user_attribute: { username: 'user1-1' }\n    }\n  ],\n  user_attribute: {}\n"})})})]}),"\n",(0,t.jsx)(n.p,{children:"You can see that the user information and tenant information that were set in SaaSus Platform earlier can be obtained on the application side."}),"\n",(0,t.jsxs)(n.p,{children:["The redirect destination URL is now received by the SaaSus SDK standard Callback process (",(0,t.jsx)(n.a,{href:"http://localhost/callback",children:"http://localhost/callback"}),"), and in that process, the browser's Local Storage or remember authentication information in a cookie."]}),"\n",(0,t.jsx)(n.p,{children:"Then, the SaaSus SDK's Auth Middleware uses the SaaSus Platform to verify the authentication information, retrieve the user information, and pack it into the Request object."}),"\n",(0,t.jsx)(n.p,{children:"Processing then moves to the application's controller, so at this point the application already has information about the logged-in person."}),"\n",(0,t.jsx)(n.p,{children:"Now, let's use this information to make our bulletin board application multi-tenant-enabled."}),"\n",(0,t.jsx)(n.h3,{id:"multi-tenancy-of-sample-application",children:"Multi-tenancy of sample application"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For Laravel: ",(0,t.jsx)(n.code,{children:"api/app/Http/Controllers/MessageController.php"})]}),"\n",(0,t.jsxs)(n.li,{children:["For Express: ",(0,t.jsx)(n.code,{children:"api/controllers/chat.ts"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This is the main process, so let's add the process to make it multi-tenant compatible here."}),"\n",(0,t.jsx)(n.p,{children:"First, change the display part.\nLet's rewrite the whole part below."}),"\n",(0,t.jsxs)(i.A,{children:[(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"   public function index(Request $request)\n   {\n       // Various user information and tenant information are entered in $request->userinfo, so use it\n       $messages = Message::where('tenant_id', $request->userinfo['tenants'][0]['id'])->get();\n       return view('messageBoard.index', ['messages' => $messages, 'plans' => $this::PLANS, 'tenant_name' => $request->userinfo['tenants'][0]['name']]);\n   }\n"})})}),(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const getChats = async (req: Request, res: Response) => {\n  try {\n    const messages = await db.Messages.findAll({\n      where: {\n        tenant_id: req.userInfo?.tenants[0].id,\n      },\n    });\n    res.render("chat", {\n      messages: messages,\n      plans: PLANS,\n      tenant_name: req.userInfo?.tenants[0].name,\n    });\n  } catch (error) {\n    console.error(error);\n    res.redirect("/chat");\n  }\n};\n'})})})]}),"\n",(0,t.jsx)(n.p,{children:"In this way, the DB will be searched based on the tenant ID that has been passed."}),"\n",(0,t.jsx)(n.p,{children:"Next is the posting part."}),"\n",(0,t.jsxs)(i.A,{children:[(0,t.jsx)(l.A,{value:"php",label:"Laravel (PHP)",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"   public function post(Request $request)\n   {\n       $validated = $request->validate([\n           'message' => 'required|max:255'\n       ]);\n\n       // Get various information from userinfo of $request and use it for judgment\n       $message = Message::create([\n            'tenant_id' => $request->userinfo['tenants'][0]['id'],\n            'user_id' => $request->userinfo['tenants'][0]['user_attribute']['username'],\n            'message' => $request->message,\n        ]);\n\n       $request->session()->regenerateToken();\n       return redirect()->route('board');\n   }\n"})})}),(0,t.jsx)(l.A,{value:"typescript",label:"Express (TS)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const postChats = async (req: Request, res: Response) => {\n  const mes = req.body.message;\n  const tenantId = req.userInfo?.tenants[0].id || "";\n  const userName =\n    req.userInfo?.tenants[0].user_attribute.username;\n  try {\n    await db.Messages.create({\n      tenant_id: tenantId,\n      user_id: userName,\n      message: mes,\n    });\n  } catch (error) {\n    console.error(error);\n  }\n  res.redirect("/chat");\n};\n'})})})]}),"\n",(0,t.jsx)(n.p,{children:"Based on the passed user attributes, the tenant ID and user name are stored as a set."}),"\n",(0,t.jsx)(n.p,{children:"Let's try displaying the user ID on the screen display as well."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"For Express: No changes are needed"}),"\n",(0,t.jsxs)(n.li,{children:["For Laravel: Edit ",(0,t.jsx)(n.code,{children:"api/resources/views/messageBoard/index.blade.php"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Around line 32, change ",(0,t.jsx)(n.code,{children:"$message->user->name"})," to ",(0,t.jsx)(n.code,{children:"$message->user_id"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Before correction\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'                   <div class="mt-4">\n                       <p>\n                           {{ $message->user->name }}\n                           <span class="text-xs text-gray-500">\n                               {{ $message->created_at->format(\'Y/m/d H:i\') }}\n                           </span>\n                       </p>\n'})}),"\n",(0,t.jsx)(n.p,{children:"After correction\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'                   <div class="mt-4">\n                       <p>\n                           {{ $message->user_id }}\n                           <span class="text-xs text-gray-500">\n                               {{ $message->created_at->format(\'Y/m/d H:i\') }}\n                           </span>\n                       </p>\n'})}),"\n",(0,t.jsx)(n.p,{children:"Multi-tenant support is now possible."}),"\n",(0,t.jsx)(n.p,{children:"Now, let's log in and try it out."}),"\n",(0,t.jsx)(n.p,{children:"As before, log in from the login screen created with SaaSus Platform."}),"\n",(0,t.jsx)(n.p,{children:"When you log in, you will see that the tenant name has changed to the one you set earlier in the SaaS Development Console."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"10",src:a(11330).A+"",width:"940",height:"344"})}),"\n",(0,t.jsx)(n.p,{children:"I don't have any data yet, so I'll post some."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"11",src:a(74987).A+"",width:"979",height:"585"})}),"\n",(0,t.jsx)(n.p,{children:"I have confirmed that the username is also displayed."}),"\n",(0,t.jsxs)(n.p,{children:["Now go back to the login screen, log in as ",(0,t.jsx)(n.a,{href:"mailto:user1-2@example.com",children:"user1-2@example.com"}),", and try posting some posts."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"12",src:a(9584).A+"",width:"965",height:"743"})}),"\n",(0,t.jsx)(n.p,{children:"Of course it will be reflected on the screen."}),"\n",(0,t.jsxs)(n.p,{children:["Now, let's log in as the user of the other tenant ",(0,t.jsx)(n.a,{href:"mailto:user2-1@example.com",children:"user2-1@example.com"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"13",src:a(25337).A+"",width:"971",height:"327"})}),"\n",(0,t.jsx)(n.p,{children:"You can see that the tenant name display has changed and the contents are now empty."}),"\n",(0,t.jsx)(n.p,{children:"I have confirmed that I can only access information for my own tenant."}),"\n",(0,t.jsxs)(n.p,{children:["Now, after making a few posts in the same way, log in as ",(0,t.jsx)(n.a,{href:"mailto:user2-2@example.com",children:"user2-2@example.com"})," and check that you can display information for the same tenant."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"14",src:a(20358).A+"",width:"971",height:"740"})}),"\n",(0,t.jsx)(n.p,{children:"In this way, separation of each tenant is completed."}),"\n",(0,t.jsx)(n.p,{children:"As for the separation method this time, we used a pool type model to perform separation within the same DB and perform tenant separation using a simple method. Even if you select a tenant separation method according to your requirements, such as schema separation or database separation, you can similarly obtain and implement tenant information using the SaaSus SDK."}),"\n",(0,t.jsx)(n.p,{children:"Now that we have separated the tenants, let's implement the fee-related functions."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},62038:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-03-4d8a48402bc40a8302f81c3914e36e56.png"},63826:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-07-76f530b18c82d9b5f374803ae86b1135.png"},65537:(e,n,a)=>{a.d(n,{A:()=>y});var s=a(96540),t=a(34164),r=a(65627),i=a(56347),l=a(50372),o=a(30604),c=a(11861),d=a(78749);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:a}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:a,attributes:s,default:t}}=e;return{value:n,label:a,attributes:s,default:t}}))}(a);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,a])}function p(e){let{value:n,tabValues:a}=e;return a.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:a}=e;const t=(0,i.W6)(),r=function(e){let{queryString:n=!1,groupId:a}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:n,groupId:a});return[(0,o.aZ)(r),(0,s.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})}),[r,t])]}function x(e){const{defaultValue:n,queryString:a=!1,groupId:t}=e,r=u(e),[i,o]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=a.find((e=>e.default))??a[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[c,h]=m({queryString:a,groupId:t}),[x,f]=function(e){let{groupId:n}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(n),[t,r]=(0,d.Dv)(a);return[t,(0,s.useCallback)((e=>{a&&r.set(e)}),[a,r])]}({groupId:t}),j=(()=>{const e=c??x;return p({value:e,tabValues:r})?e:null})();(0,l.A)((()=>{j&&o(j)}),[j]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),h(e),f(e)}),[h,f,r]),tabValues:r}}var f=a(9136);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=a(74848);function b(e){let{className:n,block:a,selectedValue:s,selectValue:i,tabValues:l}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=e=>{const n=e.currentTarget,a=o.indexOf(n),t=l[a].value;t!==s&&(c(n),i(t))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=o.indexOf(e.currentTarget)+1;n=o[a]??o[0];break}case"ArrowLeft":{const a=o.indexOf(e.currentTarget)-1;n=o[a]??o[o.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":a},n),children:l.map((e=>{let{value:n,label:a,attributes:r}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{o.push(e)},onKeyDown:h,onClick:d,...r,className:(0,t.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":s===n}),children:a??n},n)}))})}function v(e){let{lazy:n,children:a,selectedValue:r}=e;const i=(Array.isArray(a)?a:[a]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===r));return e?(0,s.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function w(e){const n=x(e);return(0,g.jsxs)("div",{className:(0,t.A)("tabs-container",j.tabList),children:[(0,g.jsx)(b,{...n,...e}),(0,g.jsx)(v,{...n,...e})]})}function y(e){const n=(0,f.A)();return(0,g.jsx)(w,{...e,children:h(e.children)},String(n))}},74987:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-11-2f2929ae136ac035bbeb7b194ff57ee6.png"},79329:(e,n,a)=>{a.d(n,{A:()=>i});a(96540);var s=a(34164);const t={tabItem:"tabItem_Ymn6"};var r=a(74848);function i(e){let{children:n,hidden:a,className:i}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(t.tabItem,i),hidden:a,children:n})}},81356:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-09-58d01bfe0a231f5539141e45e6932502.png"},85371:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-06-349e2be1301242304867121a4710a557.png"},87808:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/authentication-preference-05-b470e0be23966832788fbc0ec2c747f8.png"}}]);